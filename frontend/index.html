<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Wolfee Analytics</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="js/mock-data.js"></script>
    <script src="js/yahoo-client.js"></script>
    <link rel="icon" type="image/png" href="logo_circle.png">
</head>

<body>
    <div id="loader">
        <div class="spinner"></div>
    </div>

    <header>
        <a href="./index.html" style="text-decoration: none; display: flex; align-items: center; gap: 1rem;">
            <img src="logo.png" alt="Wolfee Logo"
                style="height: 50px; width: 50px; border-radius: 50%; object-fit: cover;">
            <h1>Wolfee Analytics</h1>
        </a>

        <!-- Search Bar -->
        <div class="search-container">
            <input type="text" id="search-input" placeholder="üîç Search stocks..." autocomplete="off">
            <button id="filter-toggle-btn" class="icon-btn" onclick="toggleFilterPopover()"
                style="background:rgba(255,255,255,0.1); border:none; color:var(--text-secondary);">
                ‚öôÔ∏è
            </button>

            <!-- Filter Popover -->
            <div id="filter-popover" class="filter-popover hidden">
                <h3>Filter Market</h3>
                <div class="filter-grid-layout">
                    <div class="filter-group">
                        <label>Price</label>
                        <div class="row-inputs">
                            <input type="number" id="filter-price-min" class="filter-input-small" placeholder="Min">
                            <input type="number" id="filter-price-max" class="filter-input-small" placeholder="Max">
                        </div>
                    </div>
                    <div class="filter-group">
                        <label>RSI</label>
                        <div class="row-inputs">
                            <input type="number" id="filter-rsi-min" class="filter-input-small" placeholder="Min">
                            <input type="number" id="filter-rsi-max" class="filter-input-small" placeholder="Max">
                        </div>
                    </div>
                    <div class="filter-group">
                        <label>Change %</label>
                        <div class="row-inputs">
                            <input type="number" id="filter-change-min" class="filter-input-small" placeholder="Min">
                            <input type="number" id="filter-change-max" class="filter-input-small" placeholder="Max">
                        </div>
                    </div>
                    <div class="filter-group">
                        <label>Min Volume</label>
                        <input type="number" id="filter-vol-min" class="filter-input-small" placeholder="100000">
                    </div>
                </div>
                <div style="margin-top:1rem; display: flex; gap: 0.5rem;">
                    <button onclick="applyFilters()"
                        style="flex:1; padding: 0.5rem; background: var(--accent-color); border: none; border-radius: 6px; color: white; cursor: pointer; font-weight: 600;">Apply
                        Filters</button>
                    <button onclick="clearFilters()"
                        style="padding: 0.5rem 1rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: white; cursor: pointer;">Clear</button>
                </div>
            </div>

            <div id="search-results" class="hidden"></div>
        </div>

        <div class="header-right">
            <!-- Region Toggle -->
            <div class="region-toggle-wrapper">
                <span id="region-label" style="font-size: 0.9rem; font-weight: bold; color: #38bdf8;">TR</span>
                <label class="switch">
                    <input type="checkbox" id="region-toggle" onchange="toggleRegion()">
                    <span class="slider round"></span>
                </label>
            </div>
            <button id="mobile-opp-btn" class="secondary-btn hidden-desktop" onclick="toggleSidebar()">üìà
                Opportunities</button>
            <div class="view-tabs">
                <button id="tab-market" class="tab-btn active" onclick="switchTab('market')">Market</button>
                <button id="tab-portfolio" class="tab-btn" onclick="switchTab('portfolio')">My Portfolio</button>
            </div>
            <button id="refresh-btn" onclick="refreshMarket()">‚Üª Refresh Market</button>
            <button id="export-btn" class="secondary-btn" onclick="openExportModal()">üìä Export Excel</button>
        </div>
    </header>

    <div class="container">
        <main>
            <!-- AI Section -->
            <div id="ai-section" class="ai-card hidden">
                <div class="ai-header">
                    <span>üê∫ Wolfee AI Protocol</span>
                    <span class="ai-badge">LIVE INSIGHT</span>
                </div>
                <p id="ai-text">Analyzing market data...</p>
            </div>

            <div id="market-view">
                <div id="stock-grid">
                    <!-- Stock cards injected here -->
                </div>
            </div>

            <div id="portfolio-view" class="hidden">
                <div class="portfolio-header">
                    <h2>Your Session Portfolio</h2>
                    <p style="color: var(--text-secondary); font-size: 0.9rem;">Items here persist only for this
                        session.</p>
                </div>
                <div id="portfolio-grid" class="stock-grid-style">
                    <!-- Portfolio cards injected here -->
                </div>
                <div id="portfolio-empty" class="hidden"
                    style="text-align:center; padding: 2rem; color: var(--text-secondary);">
                    <p>Your portfolio is empty. Add stocks from the Market view!</p>
                </div>
            </div>
        </main>

        <aside id="sidebar">
            <span id="sidebar-close" class="close-sidebar" onclick="toggleSidebar()">&times;</span>
            <div class="sidebar-section">
                <div style="display:flex; align-items:center; gap:0.5rem; margin-bottom:1rem;">

                    <h2>üìà Buy Opportunities</h2>
                </div>
                <div id="opportunities-list">
                    <p style="color: grey;">Scanning market...</p>
                </div>
            </div>

            <!-- Filter Section -->

        </aside>
    </div>

    <!-- Export Modal -->
    <div id="export-modal" class="modal hidden">
        <div class="modal-content export-content">
            <span class="close-modal" onclick="closeExportModal()">&times;</span>
            <h2>üìä Export Market Analysis</h2>
            <p style="color: var(--text-secondary); margin-bottom: 2rem;">Select a time period for your detailed Excel
                export:</p>

            <div class="export-options">
                <button class="export-card" onclick="triggerExport('daily')">
                    <div class="export-icon">üìÖ</div>
                    <div class="export-info">
                        <h3>Daily Report</h3>
                        <p>Last 5 trading days analysis</p>
                    </div>
                </button>

                <button class="export-card" onclick="triggerExport('weekly')">
                    <div class="export-icon">üóìÔ∏è</div>
                    <div class="export-info">
                        <h3>Weekly Report</h3>
                        <p>Past week performance</p>
                    </div>
                </button>

                <button class="export-card" onclick="triggerExport('monthly')">
                    <div class="export-icon">üìÜ</div>
                    <div class="export-info">
                        <h3>Monthly Report</h3>
                        <p>30-Day trend analysis</p>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Modal for detailed view -->
    <div id="stock-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <div class="modal-header-actions">
                <h2 id="modal-title" style="margin:0;">Stock Name</h2>
                <div style="display:flex; gap:0.5rem;">
                    <button id="btn-portfolio-action" class="secondary-btn" onclick="togglePortfolioItem()">+ Add to
                        Portfolio</button>
                </div>
            </div>

            <!-- Detailed Info Grid -->
            <div class="detailed-stats-grid">
                <div class="ds-item"><span class="ds-label">Symbol</span><span class="ds-val" id="stat-symbol">-</span>
                </div>
                <div class="ds-item"><span class="ds-label">Last</span><span class="ds-val" id="stat-last">-</span>
                </div>
                <div class="ds-item"><span class="ds-label">Bid</span><span class="ds-val" id="stat-bid">-</span></div>
                <div class="ds-item"><span class="ds-label">Ask</span><span class="ds-val" id="stat-ask">-</span></div>
                <div class="ds-item"><span class="ds-label">Change</span><span class="ds-val" id="stat-change">-</span>
                </div>

                <div class="ds-item"><span class="ds-label">Low</span><span class="ds-val" id="stat-low">-</span></div>
                <div class="ds-item"><span class="ds-label">High</span><span class="ds-val" id="stat-high">-</span>
                </div>
                <div class="ds-item"><span class="ds-label">Open</span><span class="ds-val" id="stat-vwap">-</span>
                </div>
                <div class="ds-item"><span class="ds-label">Prev Close</span><span class="ds-val"
                        id="stat-vol-tl">-</span></div>
                <div class="ds-item"><span class="ds-label">Volume</span><span class="ds-val" id="stat-vol-lot">-</span>
                </div>
            </div>

            <div class="modal-prediction" id="modal-prediction">
                Best Entry: Loading...
            </div>

            <div class="chart-controls">
                <button onclick="updateChart('1d')">1 Day</button>
                <button onclick="updateChart('1mo')">1 Month</button>
                <button onclick="updateChart('1y')" class="active">1 Year</button>
                <button onclick="updateChart('5y')">5 Years</button>
            </div>

            <div class="chart-container">
                <div id="stockChart" style="width:100%; height:100%;"></div>
            </div>
        </div>
    </div>



    <!-- Modular Scripts -->
    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/filter.js"></script>
    <script src="js/chart.js"></script>
    <script src="js/portfolio.js"></script>
    <script src="js/main.js"></script>
</body>

</html>